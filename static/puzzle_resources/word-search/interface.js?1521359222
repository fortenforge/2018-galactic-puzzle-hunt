var guessLog = [];
var level = 1;

for (var i = 0; i < 8; ++i) {
  guessLog.push([]);
}

$(document).ready(function() {
  function switchLevel(newLevel) {
    level = newLevel;
    refreshGuesses();
  }

  function refreshGuesses() {
    var buildHtml = "";
    for (var guess of guessLog[level - 1]) {
      buildHtml = "<p class=\"guess-result\">" + guess[0] + " (distance " + guess[1] + ")</p>" + buildHtml;
      if (guess[1] === 0) {
        buildHtml = "<h4>You got it! That's the word!</h4>" + buildHtml;
      }
    }
    $("#results").html(buildHtml);
  }

  function submitGuess() {
    $.ajax({
      type: "POST",
      url: "/puzzle/word-search/submit",
      data: JSON.stringify({
        "guess": $("#guess").val(),
        "level": $("#word-select")[0].value
      }),
      dataType: "json",
      success: function(data) {
        if (data['error']) {
          $("#error").html(data['error']);
        } else {
          guessLog[parseInt(data['level']) - 1].push([data['guess'], data['distance']]);
          $("#error").html("");
          refreshGuesses();
        }
      }
    });
    $("#guess").val("");
    $("#guess").focus();
  }

  $("#word-select").change(function() {
    switchLevel(parseInt($("#word-select")[0].value));
  });

  $("#guess_btn").click(submitGuess);
  $("#guess").keydown(function(event) {
    if (event.which === 13) {
        submitGuess();
    }
  });
});
